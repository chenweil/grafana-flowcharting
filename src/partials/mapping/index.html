<div class="edit-tab-content">
  <div class="editor-row" ng-repeat="rule in editor.rulesHandler.getRules()">
    <div ng-init="editor.initType(rule)">
      <!-- HEADER of style -->
      <div class="rule-item" ng-mouseover="editor.highlightCells(rule)" ng-mouseleave="editor.unhighlightCells(rule)">
        <div id="left" style="float:left;width:30%;">
          <span class="rule-extend" ng-click="rule.data.reduce=!rule.data.reduce">
            <i class="fa fa-chevron-right"
              ng-class="{'fa-chevron-right': rule.data.reduce, 'fa-chevron-down': rule.data.reduce === false}"> </i>
          </span>
          <span class="rule-title" ng-click="rule.data.reduce=!rule.data.reduce">{{ rule.data.order }} : 规则
            [{{ rule.data.alias }}]</span>
        </div>
        <div id="center" style="display: inline-block;margin: 0 auto;width:50%;">
          <div style="display: inline-block;margin-right: 5px;"><span>最后一个状态级别 : [{{rule.highestLevel}}]</span>
          </div>
          <div style="display: inline-block;margin-right: 5px;"><span>原始值 : [{{rule.highestValue}}]</span>
          </div>
          <div style="display: inline-block;margin-right: 5px;"><span>格式化值 : [{{rule.highestFormattedValue}}]</span>
          </div>
          <div style="display: inline-block;margin-right: 10px;">
            <div style="display: inline-block;margin-right: 5px;"><span>颜色 : </span></div>
            <div bs-tooltip="rule.highestColor"
            style="display: inline-block; width: 10px;height: 10px; background-color: {{rule.highestColor}};border: 1px solid rgb(228, 228, 228);">
          </div>
          <div style="display: inline-block;margin-right: 5px;"><span>执行时间 : [{{rule.getExectedTime()}}]</span>
          </div>
          </div>
        </div>
        <div id="right" style="float:right">
          <div id="delete" style="width:20px;clear:left;display: inline-block;">
            <span ng-if="rule.removeClick > 1" class="rule-nav" bs-tooltip="'单击两次可删除规则'"><i
                class="fa fa-w fa-remove pointer" ng-click="editor.removeRule(rule)"></i></span>
            <span ng-if="rule.removeClick === 1" class="rule-nav" bs-tooltip="'单击可删除规则'"
              style="color:brown"><i class="fa fa-w fa-remove pointer" ng-click="editor.removeRule(rule)"></i></span>
          </div>
          <div id="clone" style="width:20px;clear:left;display: inline-block;">
            <span class="rule-nav" bs-tooltip="'克隆此规则'"><i class="fa fa-copy"
                ng-click="editor.cloneRule(rule)"></i></span>
          </div>
          <div id="show/hide" style="width:20px;clear:left;display: inline-block;">
            <span class="rule-nav" ng-click="editor.toggleShow(rule,!rule.data.hidden)"
              bs-tooltip="rule.data.hidden? 'Show/enable this rule' : 'Hide/disable this rule' ">
              <i class="fa fa-chevron-right"
                ng-class="{'fa fa-w fa-eye pointer': !rule.isHidden(), 'fa fa-w fa-eye-slash pointer': rule.isHidden()}">
              </i>
            </span>
          </div>
          <div id="up" style="width:20px;clear:left;display: inline-block;">
            <span class="rule-nav" ng-if="!editor.isFirstRule($index)" bs-tooltip="'向上移'"><i
                class="fa fa-arrow-up fa-lg" ng-click="editor.moveRule(rule, true)"></i></span>
          </div>
          <div id="down" style="width:20px;clear:right;display: inline-block;">
            <span class="rule-nav" ng-if="!editor.isLastRule($index)" bs-tooltip="'向下移'"><i
                class="fa fa-arrow-down fa-lg" ng-click="editor.moveRule(rule, false)"></i></span>
          </div>
        </div>
      </div>

      <!-- CORPS -->
      <div style="padding:30px" ng-hide="rule.data.reduce==true">
        <!-- OPTIONS -->
        <div class="section gf-form-group">
          <h5 class="section-heading">
            选项
            <info-popover mode="right-normal"><span
                ng-bind-html="$GF.popover('映射对象和度量的选项', 'MAPPING','fc_archi_example')"></span>
            </info-popover>
          </h5>
          <div class="gf-form">
            <label class="gf-form-label width-10">规则名
              <info-popover mode="right-normal"><span
                  ng-bind-html="$GF.popover('规则的名称，供参考', 'MAPPING#Rule name')"></span>
              </info-popover>
            </label>
            <input type="text" class="gf-form-input width-12" ng-model="rule.data.alias" id="{{ rule.getId() }}"
              placeholder="此规则的名称" />
          </div>
          <!-- Data type -->
          <div class="gf-form" ng-if="editor.isMultipleType()">
            <label class="gf-form-label width-10">指标类型
              <info-popover mode="right-normal"><span
                  ng-bind-html="$GF.popover('仅按规则系列或表列出一种查询类型', 'MAPPING#Aggregation')"></span>
              </info-popover>
            </label>
            <div class="gf-form-select-wrapper width-12">
              <select class="gf-form-input" ng-model="rule.data.metricType"
                ng-options="c.value as c.text for c in editor.metricType" ng-blur="editor.onRulesChange()"></select>
            </div>
          </div>
          <!-- Metric Name -->
          <div class="gf-form">
            <label class="gf-form-label width-10">应用于指标
              <info-popover mode="right-normal"><span
                  ng-bind-html="$GF.popover('选择指标的别名或名称', 'MAPPING#Apply to metrics named','mp_metrics_name')"></span>
              </info-popover>
            </label>
            <input type="text" placeholder="公制的名称或正则表达式" class="gf-form-input width-12"
              ng-model="rule.data.pattern" bs-tooltip="'使用/my.*regex/syntax指定regex'"
              bs-typeahead="editor.getMetricNames" ng-blur="editor.onRulesChange()" ng-model-onblur data-min-length="0"
              data-items="100" data-placement="right" ng-if="rule.data.metricType === 'serie'" />
            <div class="gf-form-select-wrapper width-12" ng-if="rule.data.metricType === 'table'">
              <select class="gf-form-input" ng-model="rule.data.refId" ng-options="o for o in editor.getTablesName()"
                ng-blur="editor.onRulesChange()">
                <option style="display:none" value="">选择一个表</option>
              </select>
            </div>
          </div>
          <!-- Columns -->
          <div class="gf-form" ng-if="rule.data.metricType === 'table'">
            <label class="gf-form-label width-10">应用于列
              <info-popover mode="right-normal"><span
                  ng-bind-html="$GF.popover('表的列名', 'MAPPING#Aggregation')"></span>
              </info-popover>
            </label>
            <div class="gf-form-select-wrapper width-12">
              <select class="gf-form-input" ng-model="rule.data.column"
                ng-options="o for o in editor.getColumnsForTable(rule.data.refId)" ng-blur="editor.onRulesChange()">
                <option style="display:none" value="">选择列</option>
              </select>
            </div>
          </div>
          <!-- Aggregation -->
          <div class="gf-form">
            <label class="gf-form-label width-10">聚合
              <info-popover mode="right-normal"><span
                  ng-bind-html="$GF.popover('为所有度量值选择聚合', 'MAPPING#Aggregation')"></span>
              </info-popover>
            </label>
            <div class="gf-form-select-wrapper width-12">
              <select class="gf-form-input" ng-model="rule.data.aggregation"
                ng-options="c.value as c.text for c in editor.aggregationTypes"
                ng-blur="editor.onRulesChange()"></select>
            </div>
          </div>
        </div>

        <!-- TYPE -->
        <div class="section gf-form-group">
          <h5 class="section-heading">
            类型
            <info-popover mode="right-normal">
              <span
                ng-bind-html="$GF.popover('通过文本映射为显示的值指定单位（数字、字符串或日期）和类型。', 'MAPPING#Type')">
              </span>
            </info-popover>
          </h5>
          <div class="gf-form">
            <label class="gf-form-label width-10">类型
              <info-popover mode="right-normal"><span
                  ng-bind-html="$GF.popover('选择“类型”和“公制单位”以显示正确格式。', 'MAPPING#Type')"></span>
              </info-popover>
            </label>
            <div class="gf-form-select-wrapper width-16">
              <select class="gf-form-input" ng-model="rule.data.type"
                ng-options="c.value as c.text for c in editor.metricTypes" ng-change="editor.onRulesChange()"></select>
            </div>
          </div>
          <div class="gf-form" ng-if="rule.data.type === 'date'">
            <label class="gf-form-label width-10">日期格式
              <info-popover mode="right-normal"><span
                  ng-bind-html="$GF.popover('选择日期格式，以文本映射的文本形式显示。', 'MAPPING#Type')"></span>
              </info-popover>
            </label>
            <gf-form-dropdown model="rule.data.dateFormat" css-class="gf-form-input width-16" lookup-text="true"
              get-options="editor.dateFormats" on-change="editor.onRulesChange()" allow-custom="true">
            </gf-form-dropdown>
          </div>

          <div ng-if="rule.data.type === 'string'">
            <gf-form-switch class="gf-form" label-class="width-14" ng-if="rule.data.type === 'string'"
              label="Sanitize HTML" checked="rule.data.sanitize" on-change="editor.onRulesChange()"></gf-form-switch>
          </div>
          <div ng-if="rule.data.type === 'string'">
            <gf-form-switch class="gf-form" label-class="width-14" ng-if="rule.data.type === 'string'"
              label="Preserve Formatting" checked="rule.data.preserveFormat" on-change="editor.onRulesChange()">
            </gf-form-switch>
          </div>

          <div ng-if="rule.data.type === 'number'">
            <div class="gf-form">
              <label class="gf-form-label width-10">单位
                <info-popover mode="right-normal"><span
                    ng-bind-html="$GF.popover('选择聚合值的单位。', 'MAPPING#Type')"></span>
                </info-popover>
              </label>
              <div class="gf-form-dropdown-typeahead width-16" ng-model="rule.data.unit"
                dropdown-typeahead2="editor.unitFormats"
                dropdown-typeahead-on-select="editor.setUnitFormat(rule, $subItem)"></div>
            </div>
            <div class="gf-form">
              <label class="gf-form-label width-10">小数点
                <info-popover mode="right-normal"><span
                    ng-bind-html="$GF.popover('选择小数位数', 'MAPPING#Type')"></span>
                </info-popover>
              </label>
              <input type="number" class="gf-form-input width-4" data-placement="right" ng-model="rule.data.decimals"
                ng-blur="editor.onRulesChange()" />
            </div>
          </div>
        </div>

        <!-- Thresholds -->
        <ng-include src="$GF.plugin.getPartialPath() + 'mapping/thresholds/index.html'"> </ng-include>

        <!-- TOOLTIP -->
        <ng-include src="$GF.plugin.getPartialPath() + 'mapping/tooltip/index.html'"> </ng-include>

        <!-- GRAPH TOOLTIP -->
        <ng-include src="$GF.plugin.getPartialPath() + 'mapping/graph/index.html'"> </ng-include>

        <!-- MAPPINGS -->
        <div class="editor-row">
          <!-- SHAPE MAPPING -->
          <ng-include src="$GF.plugin.getPartialPath() + 'mapping/shape/index.html'"> </ng-include>

          <!-- TEXT MAPPING -->
          <ng-include src="$GF.plugin.getPartialPath() + 'mapping/text/index.html'"> </ng-include>

          <!-- LINK MAPPING -->
          <ng-include src="$GF.plugin.getPartialPath() + 'mapping/link/index.html'"> </ng-include>

          <!-- LINK MAPPING -->
          <ng-include src="$GF.plugin.getPartialPath() + 'mapping/event/index.html'"> </ng-include>

          <!-- VALUE MAPPING & RANGE MAPPING -->
          <ng-include src="$GF.plugin.getPartialPath() + 'mapping/valuemap/index.html'"> </ng-include>
        </div>

        <div class="clearfix"></div>

        <!-- BUTTONS RULES -->
        <div class="gf-form-inline">
          <div class="gf-form" style="margin-right: 5px;">
            <button class="btn btn-danger btn-small" ng-click="editor.removeRule(rule, true)"><i
                class="fa fa-trash"></i> 移除规则</button>
          </div>
          <div class="gf-form">
            <button class="btn btn-secondary btn-small" ng-click="editor.cloneRule(rule)"><i class="fa fa-copy"></i>
              复制规则</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="editor-row">
    <div class="gf-form-button-row">
      <button class="btn btn-inverse" ng-click="editor.rulesHandler.addRule('/.*/')"><i class="fa fa-plus"></i>&nbsp;添加规则</button>
    </div>
  </div>
</div>